---
alwaysApply: true
---

# FinCRM é¡¹ç›®å¼€å‘è§„èŒƒ

## è¯­è¨€è§„èŒƒ

### UI ç•Œé¢æ–‡æœ¬
- âœ… **æ‰€æœ‰ç”¨æˆ·å¯è§çš„ç•Œé¢æ–‡æœ¬å¿…é¡»ä½¿ç”¨è‹±æ–‡**
  - æŒ‰é’®æ–‡æœ¬ï¼šLogin, Register, Submit, Cancel, Save, Delete ç­‰
  - è¡¨å•æ ‡ç­¾ï¼šEmail, Password, First Name, Last Name ç­‰
  - é¡µé¢æ ‡é¢˜ï¼šDashboard, User Profile, Settings ç­‰
  - æç¤ºä¿¡æ¯ï¼šSuccess, Error, Warning ç­‰
  - è¡¨æ ¼æ ‡é¢˜ï¼šName, Status, Created At, Actions ç­‰

### ä»£ç æ³¨é‡Š
- âœ… **æ‰€æœ‰ä»£ç æ³¨é‡Šå¿…é¡»ä½¿ç”¨ä¸­æ–‡**
  - å‡½æ•°è¯´æ˜ã€å‚æ•°è¯´æ˜ã€è¿”å›å€¼è¯´æ˜ç”¨ä¸­æ–‡
  - å¤æ‚é€»è¾‘çš„è§£é‡Šç”¨ä¸­æ–‡
  - TODOã€FIXME ç­‰æ ‡è®°ç”¨ä¸­æ–‡æè¿°
  - æ–‡ä»¶å¤´éƒ¨è¯´æ˜ç”¨ä¸­æ–‡

### ç¤ºä¾‹

**æ­£ç¡®ç¤ºä¾‹** âœ…ï¼š
```typescript
/**
 * ç”¨æˆ·ç™»å½•å‡½æ•°
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns è¿”å›ç™»å½•ç»“æœ
 */
async function login(email: string, password: string) {
  // éªŒè¯é‚®ç®±æ ¼å¼
  if (!isValidEmail(email)) {
    return { error: "Invalid email format" }  // UI æ˜¾ç¤ºç”¨è‹±æ–‡
  }
  
  // è°ƒç”¨ Supabase è®¤è¯
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password,
  })
  
  if (error) {
    return { error: "Login failed" }  // UI æ˜¾ç¤ºç”¨è‹±æ–‡
  }
  
  return { success: true, message: "Login successful" }
}
```

**é”™è¯¯ç¤ºä¾‹** âŒï¼š
```typescript
// Bad: UI æ–‡æœ¬ç”¨ä¸­æ–‡ï¼Œæ³¨é‡Šç”¨è‹±æ–‡
async function login(email: string, password: string) {
  // Validate email format
  if (!isValidEmail(email)) {
    return { error: "é‚®ç®±æ ¼å¼é”™è¯¯" }  // âŒ UI ä¸åº”è¯¥ç”¨ä¸­æ–‡
  }
  return { success: true, message: "ç™»å½•æˆåŠŸ" }  // âŒ UI ä¸åº”è¯¥ç”¨ä¸­æ–‡
}
```

## æŠ€æœ¯æ ˆè§„èŒƒ

### Next.js (App Router)
- ä½¿ç”¨ App Routerï¼ˆä¸æ˜¯ Pages Routerï¼‰
- æœåŠ¡å™¨ç»„ä»¶ä¼˜å…ˆï¼Œéœ€è¦äº¤äº’æ—¶ä½¿ç”¨ "use client"
- ä½¿ç”¨ TypeScriptï¼Œæ‰€æœ‰æ–‡ä»¶å¿…é¡»æœ‰ç±»å‹å®šä¹‰

### Supabase é›†æˆ
- ä½¿ç”¨ Cookie-based è®¤è¯ï¼ˆä¸ä½¿ç”¨ localStorageï¼‰
- å®¢æˆ·ç«¯ï¼šä½¿ç”¨ `createClient()` from `@/lib/supabase/client`
- æœåŠ¡å™¨ç«¯ï¼šä½¿ç”¨ `createClient()` from `@/lib/supabase/server`
- å¯ç”¨ Row Level Security (RLS)

### UI ç»„ä»¶
- ä½¿ç”¨ shadcn/ui ç»„ä»¶åº“
- ä½¿ç”¨ Tailwind CSS è¿›è¡Œæ ·å¼å®šä¹‰
- å“åº”å¼è®¾è®¡ä¼˜å…ˆï¼ˆç§»åŠ¨ç«¯ä¼˜å…ˆï¼‰

### ä»£ç é£æ ¼
- ä½¿ç”¨ ES6+ è¯­æ³•
- ä¼˜å…ˆä½¿ç”¨ async/await è€Œä¸æ˜¯ Promise.then()
- ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ï¼ˆä¸ä½¿ç”¨ Class ç»„ä»¶ï¼‰
- Props å¿…é¡»å®šä¹‰ TypeScript æ¥å£

## æ–‡ä»¶å‘½åè§„èŒƒ

- ç»„ä»¶æ–‡ä»¶ï¼š`kebab-case.tsx` (ä¾‹å¦‚ï¼š`user-profile.tsx`)
- å·¥å…·å‡½æ•°ï¼š`kebab-case.ts` (ä¾‹å¦‚ï¼š`format-date.ts`)
- ç±»å‹å®šä¹‰ï¼š`kebab-case.ts` (ä¾‹å¦‚ï¼š`user-types.ts`)
- é¡µé¢è·¯ç”±ï¼š`page.tsx` (App Router çº¦å®š)

## é”™è¯¯å¤„ç†è§„èŒƒ

- æ‰€æœ‰å¼‚æ­¥æ“ä½œå¿…é¡»æœ‰é”™è¯¯å¤„ç†
- é”™è¯¯ä¿¡æ¯å¯¹ç”¨æˆ·æ˜¾ç¤ºæ—¶ç”¨è‹±æ–‡
- é”™è¯¯æ—¥å¿—å¯ä»¥ç”¨ä¸­æ–‡æ³¨é‡Šè¯´æ˜é”™è¯¯åŸå› 
- ä½¿ç”¨ try-catch æˆ– error è¿”å›å€¼

## å®‰å…¨è§„èŒƒ

- æ°¸è¿œä¸è¦åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥
- API è°ƒç”¨ä½¿ç”¨ Supabase RLS ä¿æŠ¤
- ç”¨æˆ·è¾“å…¥å¿…é¡»éªŒè¯å’Œæ¸…ç†

## ç¤ºä¾‹ï¼šå®Œæ•´çš„ç»„ä»¶

```typescript
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { useAuth } from "@/components/auth-provider"

interface LoginFormProps {
  onSuccess?: () => void
}

/**
 * ç™»å½•è¡¨å•ç»„ä»¶
 * æä¾›é‚®ç®±å’Œå¯†ç ç™»å½•åŠŸèƒ½
 */
export function LoginForm({ onSuccess }: LoginFormProps) {
  const [email, setEmail] = useState("")
  const [password, setPassword] = useState("")
  const [error, setError] = useState<string | null>(null)
  const { login, isLoading } = useAuth()

  /**
   * å¤„ç†è¡¨å•æäº¤
   */
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
    setError(null)
    
    // è°ƒç”¨ç™»å½•å‡½æ•°
    const result = await login(email, password)
    
    if (result.success) {
      // ç™»å½•æˆåŠŸï¼Œæ‰§è¡Œå›è°ƒ
      onSuccess?.()
    } else {
      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆè‹±æ–‡ï¼‰
      setError(result.error || "Login failed")
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {/* é‚®ç®±è¾“å…¥æ¡† */}
      <div>
        <label htmlFor="email" className="text-sm font-medium">
          Email
        </label>
        <Input
          id="email"
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="Enter your email"
          required
        />
      </div>

      {/* å¯†ç è¾“å…¥æ¡† */}
      <div>
        <label htmlFor="password" className="text-sm font-medium">
          Password
        </label>
        <Input
          id="password"
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          placeholder="Enter your password"
          required
        />
      </div>

      {/* é”™è¯¯æç¤º */}
      {error && (
        <div className="text-sm text-red-500">
          {error}
        </div>
      )}

      {/* æäº¤æŒ‰é’® */}
      <Button type="submit" disabled={isLoading} className="w-full">
        {isLoading ? "Loading..." : "Login"}
      </Button>
    </form>
  )
}
```

## ç»ˆç«¯å‘½ä»¤è§„èŒƒ

### Windows ç¯å¢ƒ
- âœ… **å¿…é¡»ä½¿ç”¨ Windows CMD/PowerShell å‘½ä»¤**
- âŒ **ä¸è¦ä½¿ç”¨ Unix/Linux å‘½ä»¤**ï¼ˆå¦‚ ls, cat, rm ç­‰ï¼‰

### å¸¸ç”¨å‘½ä»¤å¯¹ç…§è¡¨

| æ“ä½œ | âŒ Unix/Linux | âœ… Windows CMD | âœ… PowerShell |
|------|--------------|---------------|--------------|
| åˆ—å‡ºæ–‡ä»¶ | `ls` | `dir` | `Get-ChildItem` æˆ– `ls` |
| æŸ¥çœ‹æ–‡ä»¶ | `cat file.txt` | `type file.txt` | `Get-Content file.txt` |
| åˆ é™¤æ–‡ä»¶ | `rm file.txt` | `del file.txt` | `Remove-Item file.txt` |
| åˆ é™¤ç›®å½• | `rm -rf dir/` | `rmdir /s /q dir` | `Remove-Item -Recurse -Force dir` |
| å¤åˆ¶æ–‡ä»¶ | `cp src dst` | `copy src dst` | `Copy-Item src dst` |
| ç§»åŠ¨æ–‡ä»¶ | `mv src dst` | `move src dst` | `Move-Item src dst` |
| åˆ›å»ºç›®å½• | `mkdir dir` | `mkdir dir` | `New-Item -ItemType Directory dir` |
| æŸ¥æ‰¾è¿›ç¨‹ | `ps aux \| grep node` | `tasklist \| findstr node` | `Get-Process \| Where-Object {$_.Name -like "*node*"}` |
| æ€æ­»è¿›ç¨‹ | `kill -9 PID` | `taskkill /F /PID PID` | `Stop-Process -Id PID -Force` |
| æŸ¥çœ‹ç«¯å£ | `netstat -tulpn` | `netstat -ano` | `Get-NetTCPConnection` |
| è®¾ç½®ç¯å¢ƒå˜é‡ | `export VAR=value` | `set VAR=value` | `$env:VAR="value"` |
| æ¸…å± | `clear` | `cls` | `Clear-Host` æˆ– `cls` |
| å½“å‰ç›®å½• | `pwd` | `cd` | `Get-Location` æˆ– `pwd` |
| å‘½ä»¤å†å² | `history` | `doskey /history` | `Get-History` æˆ– `h` |

### æ­£ç¡®ç¤ºä¾‹ âœ…

```powershell
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆPowerShellï¼‰
Remove-Item -Recurse -Force .next
Remove-Item -Recurse -Force node_modules\.cache

# æˆ–ä½¿ç”¨ CMD
rmdir /s /q .next
rmdir /s /q node_modules\.cache

# æŸ¥çœ‹ Supabase çŠ¶æ€
supabase status

# æŸ¥çœ‹è¿è¡Œä¸­çš„ Node è¿›ç¨‹
tasklist | findstr node

# æˆ–ä½¿ç”¨ PowerShell
Get-Process | Where-Object {$_.Name -like "*node*"}
```

### é”™è¯¯ç¤ºä¾‹ âŒ

```bash
# âŒ ä¸è¦ä½¿ç”¨ Unix å‘½ä»¤
rm -rf .next
ls -la
cat package.json
ps aux | grep node
kill -9 1234
```

### å¼€å‘æœåŠ¡å™¨å¯åŠ¨è§„èŒƒ

**åœ¨è¿è¡Œ `npm run dev` ä¹‹å‰ï¼Œå¿…é¡»å…ˆå…³é—­ 3000 ç«¯å£**

#### æ–¹æ³• 1: æŸ¥æ‰¾å¹¶å…³é—­ç«¯å£è¿›ç¨‹ï¼ˆPowerShellï¼‰
```powershell
# 1. æŸ¥æ‰¾å ç”¨ 3000 ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :3000

# 2. æ ¹æ® PID å…³é—­è¿›ç¨‹
taskkill /F /PID <PID>

# æˆ–ä½¿ç”¨ PowerShell ä¸€é”®å…³é—­
Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue | ForEach-Object { Stop-Process -Id $_.OwningProcess -Force }

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

#### æ–¹æ³• 2: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»º `scripts/start-dev.ps1`ï¼š
```powershell
# å…³é—­ 3000 ç«¯å£
Write-Host "Checking port 3000..." -ForegroundColor Yellow
$process = Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue
if ($process) {
    Write-Host "Closing port 3000..." -ForegroundColor Yellow
    Stop-Process -Id $process.OwningProcess -Force
    Write-Host "Port 3000 closed." -ForegroundColor Green
    Start-Sleep -Seconds 1
} else {
    Write-Host "Port 3000 is available." -ForegroundColor Green
}

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
Write-Host "Starting development server..." -ForegroundColor Green
npm run dev
```

ä½¿ç”¨æ–¹æ³•ï¼š
```cmd
scripts\start-dev.bat
```

#### æ–¹æ³• 3: CMD å‘½ä»¤
```cmd
REM æŸ¥æ‰¾ 3000 ç«¯å£è¿›ç¨‹
netstat -ano | findstr :3000

REM å…³é—­è¿›ç¨‹ï¼ˆæ›¿æ¢ <PID> ä¸ºå®é™…è¿›ç¨‹ IDï¼‰
taskkill /F /PID <PID>

REM å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

## æ–‡æ¡£ç¼–å†™è§„èŒƒ

### åŸºæœ¬åŸåˆ™
- âŒ **ä¸è¦ä¸»åŠ¨åˆ›å»ºæ–‡æ¡£**ï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚
- âœ… **æ‰€æœ‰æ–‡æ¡£å¿…é¡»æ”¾åœ¨ `docs/` ç›®å½•**
- âœ… æ–‡æ¡£æ–‡ä»¶åä½¿ç”¨ `kebab-case.md` æ ¼å¼
- âœ… æ–‡æ¡£å†…å®¹å¯ä»¥ä½¿ç”¨ä¸­æ–‡æˆ–è‹±æ–‡ï¼Œæ ¹æ®ç”¨æˆ·éœ€æ±‚å†³å®š

### ä¸è¦åˆ›å»ºçš„æ–‡æ¡£ç±»å‹ï¼ˆé™¤éç”¨æˆ·è¦æ±‚ï¼‰
- âŒ README.mdï¼ˆé¡¹ç›®å·²æœ‰ï¼‰
- âŒ API æ–‡æ¡£
- âŒ ä½¿ç”¨æŒ‡å—
- âŒ å¼€å‘æ—¥å¿—
- âŒ æ›´æ–°æ—¥å¿— (CHANGELOG.md)
- âŒ è´¡çŒ®æŒ‡å— (CONTRIBUTING.md)

### å…è®¸åˆ›å»ºçš„æƒ…å†µ
1. **ç”¨æˆ·æ˜ç¡®è¦æ±‚**ï¼š
   - "å†™ä¸€ä¸ª XX åŠŸèƒ½çš„æ–‡æ¡£"
   - "åˆ›å»ºä¸€ä¸ªä½¿ç”¨è¯´æ˜"
   - "å¸®æˆ‘ç”Ÿæˆ API æ–‡æ¡£"

2. **ä»£ç æ³¨é‡Šä¼˜å…ˆ**ï¼š
   - å¤æ‚é€»è¾‘ç”¨æ³¨é‡Šè¯´æ˜ï¼Œä¸éœ€è¦å•ç‹¬æ–‡æ¡£
   - å‡½æ•°è¯´æ˜ç”¨ JSDoc/TSDoc æ³¨é‡Š
   - ç»„ä»¶è¯´æ˜ç”¨å†…è”æ³¨é‡Š

### æ–‡æ¡£å­˜æ”¾ä½ç½®

```
D:\FinCRM\
â”œâ”€â”€ docs/                    # âœ… æ‰€æœ‰æ–‡æ¡£æ”¾è¿™é‡Œ
â”‚   â”œâ”€â”€ api/                # API æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ authentication.md
â”‚   â”‚   â””â”€â”€ user-management.md
â”‚   â”œâ”€â”€ guides/             # ä½¿ç”¨æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ getting-started.md
â”‚   â”‚   â””â”€â”€ deployment.md
â”‚   â”œâ”€â”€ architecture/       # æ¶æ„æ–‡æ¡£
â”‚   â”‚   â””â”€â”€ system-design.md
â”‚   â””â”€â”€ development/        # å¼€å‘æ–‡æ¡£
â”‚       â””â”€â”€ coding-standards.md
â”œâ”€â”€ README.md               # âœ… é¡¹ç›®æ ¹ç›®å½•ï¼ˆå·²å­˜åœ¨ï¼‰
â”œâ”€â”€ CHANGELOG.md            # âœ… é¡¹ç›®æ ¹ç›®å½•ï¼ˆå¦‚éœ€è¦ï¼‰
â””â”€â”€ ...
```

### æ­£ç¡®æµç¨‹ç¤ºä¾‹

**åœºæ™¯ 1ï¼šç”¨æˆ·æœªè¦æ±‚åˆ›å»ºæ–‡æ¡£** âœ…
```
ç”¨æˆ·ï¼š"å¸®æˆ‘å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½"
AIï¼š
1. åˆ›å»ºç»„ä»¶ä»£ç 
2. æ·»åŠ ä»£ç æ³¨é‡Š
3. âŒ ä¸åˆ›å»ºé¢å¤–çš„æ–‡æ¡£
```

**åœºæ™¯ 2ï¼šç”¨æˆ·æ˜ç¡®è¦æ±‚æ–‡æ¡£** âœ…
```
ç”¨æˆ·ï¼š"å®ç°ç™»å½•åŠŸèƒ½ï¼Œå¹¶å†™ä¸€ä¸ªä½¿ç”¨æ–‡æ¡£"
AIï¼š
1. åˆ›å»ºç»„ä»¶ä»£ç 
2. åˆ›å»º docs/guides/login-guide.md
3. åœ¨æ–‡æ¡£ä¸­è¯´æ˜ä½¿ç”¨æ–¹æ³•
```

**åœºæ™¯ 3ï¼šå¤æ‚åŠŸèƒ½è¯´æ˜** âœ…
```
ç”¨æˆ·ï¼š"è¿™ä¸ªç»„ä»¶å¤ªå¤æ‚äº†ï¼Œè¯´æ˜ä¸€ä¸‹"
AIï¼š
1. åœ¨ä»£ç ä¸­æ·»åŠ è¯¦ç»†æ³¨é‡Š
2. å¦‚æœæ³¨é‡Šä¸å¤Ÿï¼Œå†è¯¢é—®æ˜¯å¦éœ€è¦åˆ›å»ºæ–‡æ¡£
3. ç”¨æˆ·åŒæ„åï¼Œåˆ›å»º docs/components/component-name.md
```

## é¡¹ç›®ç‰¹å®šè§„èŒƒ

### ç›®å½•ç»“æ„çº¦å®š
```
D:\FinCRM\
â”œâ”€â”€ app/                # Next.js App Router é¡µé¢
â”œâ”€â”€ components/         # React ç»„ä»¶
â”œâ”€â”€ lib/               # å·¥å…·å‡½æ•°å’Œåº“
â”œâ”€â”€ docs/              # âœ… æ–‡æ¡£ç›®å½•ï¼ˆæ–°å»ºæ–‡æ¡£æ”¾è¿™é‡Œï¼‰
â”œâ”€â”€ supabase/          # Supabase é…ç½®å’Œè¿ç§»
â”œâ”€â”€ public/            # é™æ€èµ„æº
â””â”€â”€ scripts/           # è„šæœ¬æ–‡ä»¶
```

### Git æäº¤è§„èŒƒ
- æäº¤ä¿¡æ¯ä½¿ç”¨è‹±æ–‡
- æ ¼å¼ï¼š`type: description`
- å¸¸ç”¨ç±»å‹ï¼š
  - `feat`: æ–°åŠŸèƒ½
  - `fix`: ä¿®å¤ bug
  - `docs`: æ–‡æ¡£æ›´æ–°
  - `style`: ä»£ç æ ¼å¼è°ƒæ•´
  - `refactor`: ä»£ç é‡æ„
  - `test`: æµ‹è¯•ç›¸å…³
  - `chore`: æ„å»ºæˆ–è¾…åŠ©å·¥å…·æ›´æ”¹

#### âš ï¸ é‡è¦æé†’
- âœ… **æ¯æ¬¡ä¿®å¤é—®é¢˜æˆ–å®ŒæˆåŠŸèƒ½åï¼Œå¿…é¡»åŠæ—¶æäº¤ä»£ç **
- âœ… æäº¤å‰ç¡®ä¿ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œ
- âœ… æäº¤ä¿¡æ¯è¦æ¸…æ™°æè¿°æ‰€åšçš„æ”¹åŠ¨
- âœ… é¿å…ç§¯ç´¯å¤ªå¤šæ”¹åŠ¨æ‰æäº¤

### ç¤ºä¾‹
```bash
# âœ… æ­£ç¡®
git commit -m "feat: add user login component"
git commit -m "fix: resolve authentication token issue"
git commit -m "docs: update API documentation"

# âŒ é”™è¯¯
git commit -m "æ·»åŠ ç™»å½•åŠŸèƒ½"
git commit -m "ä¿®å¤äº†ä¸€äº›bug"
```

## æ•°æ®åº“å¼€å‘è§„èŒƒ

### å¼€å‘é˜¶æ®µ vs ç”Ÿäº§é˜¶æ®µ

#### å¼€å‘é˜¶æ®µï¼ˆæ¨èåšæ³•ï¼‰âœ…

**åŸåˆ™**ï¼šæ•°æ®ä¸é‡è¦ï¼Œå¿«é€Ÿè¿­ä»£ä¼˜å…ˆ

- âœ… **ç›´æ¥ä¿®æ”¹ SQL æ–‡ä»¶**ï¼ˆ`supabase/migrations/*.sql`ï¼‰
- âœ… **ä¿®æ”¹ç§å­æ•°æ®**ï¼ˆ`supabase/seed.sql`ï¼‰
- âœ… **å®Œå…¨é‡ç½®æ•°æ®åº“**ï¼Œä¸åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
- âœ… ä½¿ç”¨ `supabase db reset` æ¸…ç©ºå¹¶é‡æ–°åˆå§‹åŒ–

**æ“ä½œæµç¨‹**ï¼š
```powershell
# 1. ä¿®æ”¹ç°æœ‰ SQL æ–‡ä»¶ï¼ˆå¦‚ 001_initial_schema.sqlï¼‰
# 2. ä¿®æ”¹ç§å­æ•°æ®ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
# 3. é‡ç½®æ•°æ®åº“
supabase db reset

# ç¡®è®¤é‡ç½®ï¼ˆä¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼‰
# è¾“å…¥ 'y' ç¡®è®¤
```

**ä¼˜ç‚¹**ï¼š
- ğŸš€ å¿«é€Ÿè¿­ä»£ï¼Œæ— éœ€ç®¡ç†å¤æ‚çš„è¿ç§»å†å²
- ğŸ§¹ ä¿æŒè¿ç§»æ–‡ä»¶ç®€æ´ï¼Œæ˜“äºç†è§£
- ğŸ”„ éšæ—¶å¯ä»¥ä»å¤´å¼€å§‹ï¼Œé¿å…è¿ç§»å†²çª

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ é‡ç½®ä¼šæ¸…ç©ºæ‰€æœ‰æµ‹è¯•æ•°æ®
- âš ï¸ éœ€è¦é‡æ–°åˆ›å»ºæµ‹è¯•ç”¨æˆ·
- âš ï¸ ä»…é€‚ç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒ

#### ç”Ÿäº§é˜¶æ®µï¼ˆå¿…é¡»éµå¾ªï¼‰âš ï¸

**åŸåˆ™**ï¼šä¿æŠ¤ç”¨æˆ·æ•°æ®ï¼Œå¯è¿½æº¯å˜æ›´

- âœ… **åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶**ï¼ˆé€’å¢ç¼–å·ï¼‰
- âœ… **åªå…è®¸å‘å‰è¿ç§»**ï¼ˆadditive changesï¼‰
- âŒ **ç¦æ­¢ä¿®æ”¹å·²éƒ¨ç½²çš„è¿ç§»æ–‡ä»¶**
- âŒ **ç¦æ­¢ä½¿ç”¨ db reset**ï¼ˆä¼šåˆ é™¤ç”¨æˆ·æ•°æ®ï¼‰

**æ“ä½œæµç¨‹**ï¼š
```powershell
# 1. åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
supabase migration new add_user_avatar_column

# 2. ç¼–å†™è¿ç§» SQL
# supabase/migrations/20240101000000_add_user_avatar_column.sql

# 3. æµ‹è¯•è¿ç§»
supabase db reset  # æœ¬åœ°æµ‹è¯•

# 4. éƒ¨ç½²åˆ°ç”Ÿäº§
supabase db push  # åº”ç”¨åˆ°è¿œç¨‹æ•°æ®åº“
```

### å¸¸ç”¨æ•°æ®åº“å‘½ä»¤

```powershell
# é‡ç½®æœ¬åœ°æ•°æ®åº“ï¼ˆå¼€å‘é˜¶æ®µï¼‰
supabase db reset

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
supabase status

# ç”Ÿæˆ TypeScript ç±»å‹ï¼ˆåœ¨ä¿®æ”¹è¡¨ç»“æ„åï¼‰
supabase gen types typescript --local > lib/supabase/types.ts

# æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
supabase db push

# ä»è¿œç¨‹æ‹‰å–è¿ç§»
supabase db pull
```

### è¿ç§»æ–‡ä»¶å‘½åè§„èŒƒ

```
supabase/migrations/
â”œâ”€â”€ 001_initial_schema.sql           # åˆå§‹æ•°æ®åº“æ¶æ„
â”œâ”€â”€ 002_supplementary_tables.sql     # è¡¥å……è¡¨
â”œâ”€â”€ 003_auto_create_profile.sql      # è‡ªåŠ¨åˆ›å»º profile è§¦å‘å™¨
â””â”€â”€ 004_add_new_feature.sql          # æ–°åŠŸèƒ½ï¼ˆå¦‚éœ€è¦ï¼‰
```

### ç§å­æ•°æ®è§„èŒƒ

åœ¨ `supabase/seed.sql` ä¸­æ·»åŠ æµ‹è¯•æ•°æ®ï¼š

```sql
-- æ’å…¥æµ‹è¯•ç”¨æˆ·ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
INSERT INTO profiles (id, email, first_name, last_name, role)
VALUES 
  ('uuid-1', 'admin@example.com', 'Admin', 'User', 'Admin'),
  ('uuid-2', 'user@example.com', 'Test', 'User', 'User')
ON CONFLICT (id) DO NOTHING;
```

### å¼€å‘å·¥ä½œæµæ€»ç»“

```powershell
# å…¸å‹çš„å¼€å‘æµç¨‹
# 1. ä¿®æ”¹æ•°æ®åº“æ¶æ„
# ç¼–è¾‘ supabase/migrations/001_initial_schema.sql

# 2. ä¿®æ”¹ç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰
# ç¼–è¾‘ supabase/seed.sql

# 3. é‡ç½®æ•°æ®åº“
supabase db reset

# 4. æ›´æ–° TypeScript ç±»å‹
supabase gen types typescript --local > lib/supabase/types.ts

# 5. é‡å¯å¼€å‘æœåŠ¡å™¨
npm run dev:safe
```

## å¤æ‚è¡¨å•å¯¹è¯æ¡†è§„èŒƒ

### é€‚ç”¨åœºæ™¯
å¯¹äºæ•°æ®åº“ä¸­å­—æ®µè¾ƒå¤šçš„è¡¨ï¼ˆè¶…è¿‡ 10 ä¸ªå­—æ®µï¼‰ï¼Œåº”ä½¿ç”¨å…¨å±å¯¹è¯æ¡†æ¨¡å¼ï¼Œå¹¶å®ç°æ•°æ®æŒä¹…åŒ–åŠŸèƒ½ã€‚

### å¿…é¡»å®ç°çš„åŠŸèƒ½

#### 1. å…¨å±æ˜¾ç¤ºæ¨¡å¼å’Œå›ºå®šé¡¶éƒ¨å¸ƒå±€
- âœ… å¯¹è¯æ¡†æ”¯æŒå…¨å±å’Œæ ‡å‡†æ¨¡å¼åˆ‡æ¢
- âœ… é»˜è®¤ä½¿ç”¨å…¨å±æ¨¡å¼ï¼Œé€‚åˆå­—æ®µå¤šçš„è¡¨å•
- âœ… æä¾›åˆ‡æ¢æŒ‰é’®ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©æ˜¾ç¤ºæ¨¡å¼
- âœ… **æ‰€æœ‰æ“ä½œæŒ‰é’®å›ºå®šåœ¨é¡¶éƒ¨å³ä¸Šè§’**
- âœ… **æ»šåŠ¨å†…å®¹æ—¶æŒ‰é’®å§‹ç»ˆå¯è§**

**å®ç°ç¤ºä¾‹**ï¼š
```typescript
const [isFullscreen, setIsFullscreen] = useState(true)

<DialogContent 
  className={`${
    isFullscreen 
      ? "w-screen h-screen max-w-none max-h-none m-0 rounded-none" 
      : "max-w-4xl max-h-[90vh]"
  } flex flex-col p-0`}
>
  {/* å›ºå®šçš„é¡¶éƒ¨æ ‡é¢˜å’ŒæŒ‰é’®åŒºåŸŸ */}
  <div className="sticky top-0 z-10 bg-background border-b px-6 py-4">
    <DialogHeader className="flex-row items-start justify-between space-y-0">
      <div className="flex-1 pr-4">
        <DialogTitle>Title</DialogTitle>
        <DialogDescription>Description</DialogDescription>
      </div>
      
      {/* å³ä¸Šè§’æŒ‰é’®åŒºåŸŸ - å§‹ç»ˆå¯è§ */}
      <div className="flex gap-2 shrink-0">
        <Button size="sm">Action</Button>
        <Button size="sm" onClick={() => setIsFullscreen(!isFullscreen)}>
          <Maximize2 className="h-4 w-4" />
        </Button>
      </div>
    </DialogHeader>
  </div>

  {/* å¯æ»šåŠ¨çš„å†…å®¹åŒºåŸŸ */}
  <div className="flex-1 overflow-y-auto px-6 py-4">
    {/* è¡¨å•å†…å®¹ */}
  </div>
</DialogContent>
```

#### 2. æ•°æ®æŒä¹…åŒ–åŠŸèƒ½
- âœ… ä½¿ç”¨ `localStorage` ä¿å­˜è¡¨å•è‰ç¨¿
- âœ… å…³é—­å¯¹è¯æ¡†åï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±
- âœ… é‡æ–°æ‰“å¼€å¯¹è¯æ¡†æ—¶ï¼Œè‡ªåŠ¨æ¢å¤ä¹‹å‰è¾“å…¥çš„æ•°æ®
- âœ… æˆåŠŸæäº¤åï¼Œè‡ªåŠ¨æ¸…é™¤è‰ç¨¿æ•°æ®

**å®ç°è¦ç‚¹**ï¼š
```typescript
// å®šä¹‰å­˜å‚¨ key
const DRAFT_STORAGE_KEY = "form_name_draft"

// ä¿å­˜è‰ç¨¿
function saveDraft(data: FormValues) {
  localStorage.setItem(DRAFT_STORAGE_KEY, JSON.stringify(data))
}

// åŠ è½½è‰ç¨¿
function loadDraft() {
  const saved = localStorage.getItem(DRAFT_STORAGE_KEY)
  return saved ? JSON.parse(saved) : null
}

// æ¸…é™¤è‰ç¨¿
function clearDraft() {
  localStorage.removeItem(DRAFT_STORAGE_KEY)
}
```

#### 3. è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- âœ… ç›‘å¬è¡¨å•å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜è‰ç¨¿
- âœ… ä½¿ç”¨é˜²æŠ–ï¼ˆdebounceï¼‰æœºåˆ¶ï¼Œé¿å…é¢‘ç¹ä¿å­˜
- âœ… ä»…åœ¨æ–°å»ºæ¨¡å¼ä¸‹å¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼ˆç¼–è¾‘æ¨¡å¼ä¸éœ€è¦ï¼‰

**å®ç°ç¤ºä¾‹**ï¼š
```typescript
useEffect(() => {
  if (!editMode && dialogOpen) {
    const subscription = form.watch((value) => {
      const timeoutId = setTimeout(() => {
        saveDraft(value as FormValues)
      }, 1000) // 1ç§’é˜²æŠ–
      return () => clearTimeout(timeoutId)
    })
    return () => subscription.unsubscribe()
  }
}, [form, editMode, dialogOpen])
```

#### 4. æ‰‹åŠ¨æ“ä½œæŒ‰é’®
- âœ… **Save Draft**: æ‰‹åŠ¨ä¿å­˜å½“å‰è¡¨å•æ•°æ®
- âœ… **Clear Form**: æ¸…ç©ºæ‰€æœ‰è¡¨å•æ•°æ®å’Œè‰ç¨¿
- âœ… ä»…åœ¨æ–°å»ºæ¨¡å¼ä¸‹æ˜¾ç¤ºè¿™äº›æŒ‰é’®
- âœ… **æ‰€æœ‰æŒ‰é’®å›ºå®šåœ¨é¡¶éƒ¨å³ä¸Šè§’åŒºåŸŸ**
- âœ… **ä½¿ç”¨ sticky å®šä½ç¡®ä¿æ»šåŠ¨æ—¶å§‹ç»ˆå¯è§**

**UI å¸ƒå±€ç¤ºä¾‹**ï¼š
```typescript
{/* å›ºå®šé¡¶éƒ¨åŒºåŸŸ */}
<div className="sticky top-0 z-10 bg-background border-b px-6 py-4">
  <DialogHeader className="flex-row items-start justify-between space-y-0">
    <div className="flex-1 pr-4">
      <DialogTitle>Create New Item</DialogTitle>
      <DialogDescription>Fill in the details...</DialogDescription>
    </div>
    
    {/* å³ä¸Šè§’æŒ‰é’®åŒºåŸŸ - å§‹ç»ˆå¯è§ */}
    <div className="flex gap-2 shrink-0">
      <Button variant="outline" size="sm" onClick={handleSaveDraft} title="Save Draft">
        <Save className="h-4 w-4 mr-2" />
        Save Draft
      </Button>
      <Button variant="outline" size="sm" onClick={handleClearForm} title="Clear Form">
        <Trash2 className="h-4 w-4 mr-2" />
        Clear Form
      </Button>
      <Button variant="ghost" size="sm" onClick={() => setIsFullscreen(!isFullscreen)} 
              title={isFullscreen ? "Exit Fullscreen" : "Enter Fullscreen"}>
        <Maximize2 className="h-4 w-4" />
      </Button>
    </div>
  </DialogHeader>
</div>
```

#### 5. ç”¨æˆ·æç¤º
- âœ… æ¢å¤è‰ç¨¿æ—¶ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
- âœ… ä¿å­˜è‰ç¨¿æˆåŠŸåï¼Œæ˜¾ç¤ºç¡®è®¤æç¤º
- âœ… æ¸…ç©ºè¡¨å•å‰ï¼Œæœ€å¥½æœ‰ç¡®è®¤æç¤º
- âœ… åœ¨è¡¨å•åº•éƒ¨æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æç¤º

**æç¤ºç¤ºä¾‹**ï¼š
```typescript
// æ¢å¤è‰ç¨¿æç¤º
toast({
  title: "Draft Restored",
  description: "Your previous draft has been restored",
})

// åº•éƒ¨æç¤ºæ–‡æœ¬
<div className="text-sm text-muted-foreground">
  * Your changes are automatically saved as draft
</div>
```

### å®Œæ•´å®ç°å‚è€ƒ

å‚è§ `components/products/product-dialog.tsx` è·å–å®Œæ•´å®ç°ç¤ºä¾‹ã€‚

### å…³é”®ç‰¹æ€§æ¸…å•

å¯¹äºå¤æ‚è¡¨å•å¯¹è¯æ¡†ï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š

**å¸ƒå±€å’Œæ˜¾ç¤º**
- [ ] å…¨å±æ˜¾ç¤ºæ¨¡å¼ï¼ˆå¯åˆ‡æ¢ï¼‰
- [ ] å›ºå®šé¡¶éƒ¨æŒ‰é’®åŒºåŸŸï¼ˆsticky positioningï¼‰
- [ ] æ‰€æœ‰æ“ä½œæŒ‰é’®åœ¨é¡¶éƒ¨å³ä¸Šè§’
- [ ] æ»šåŠ¨å†…å®¹æ—¶æŒ‰é’®å§‹ç»ˆå¯è§
- [ ] ä½¿ç”¨ flex å¸ƒå±€åˆ†ç¦»å›ºå®šåŒºå’Œæ»šåŠ¨åŒº

**æ•°æ®æŒä¹…åŒ–**
- [ ] localStorage æ•°æ®æŒä¹…åŒ–
- [ ] è‡ªåŠ¨ä¿å­˜è‰ç¨¿ï¼ˆé˜²æŠ–ï¼‰
- [ ] æ‰‹åŠ¨ä¿å­˜è‰ç¨¿æŒ‰é’®
- [ ] æ¸…ç©ºè¡¨å•æŒ‰é’®
- [ ] è‰ç¨¿æ¢å¤æç¤º
- [ ] æˆåŠŸæäº¤åæ¸…é™¤è‰ç¨¿
- [ ] ä»…æ–°å»ºæ¨¡å¼å¯ç”¨è‰ç¨¿åŠŸèƒ½
- [ ] ç¼–è¾‘æ¨¡å¼åŠ è½½ç°æœ‰æ•°æ®

**ç”¨æˆ·ä½“éªŒ**
- [ ] æŒ‰é’®æ·»åŠ  title å±æ€§æ˜¾ç¤ºæç¤º
- [ ] ä½¿ç”¨å›¾æ ‡å¢å¼ºå¯è¯†åˆ«æ€§
- [ ] åº•éƒ¨æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æç¤ºæ–‡æœ¬

### æ³¨æ„äº‹é¡¹

1. **éšç§æ•°æ®**: ä¸è¦åœ¨ localStorage ä¸­ä¿å­˜æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€æ”¯ä»˜ä¿¡æ¯ï¼‰
2. **å­˜å‚¨é™åˆ¶**: localStorage æœ‰ 5-10MB é™åˆ¶ï¼Œæ³¨æ„æ•°æ®å¤§å°
3. **æ¸…ç†ç­–ç•¥**: æˆåŠŸæäº¤åå¿…é¡»æ¸…é™¤è‰ç¨¿ï¼Œé¿å…æ•°æ®æ··ä¹±
4. **ç¼–è¾‘æ¨¡å¼**: ç¼–è¾‘ç°æœ‰æ•°æ®æ—¶ï¼Œä¸ä½¿ç”¨è‰ç¨¿åŠŸèƒ½
5. **æµ‹è¯•**: ç¡®ä¿å…³é—­/é‡å¼€å¯¹è¯æ¡†èƒ½æ­£ç¡®æ¢å¤æ•°æ®
6. **å¸ƒå±€ç»“æ„**: ä½¿ç”¨ `flex flex-col p-0` åœ¨ DialogContent ä¸Šï¼Œåˆ†ç¦»å›ºå®šåŒºå’Œæ»šåŠ¨åŒº
7. **å›ºå®šå®šä½**: ä½¿ç”¨ `sticky top-0 z-10` ç¡®ä¿é¡¶éƒ¨åŒºåŸŸå§‹ç»ˆå¯è§
8. **æŒ‰é’®ä½ç½®**: æ‰€æœ‰æ“ä½œæŒ‰é’®ç»Ÿä¸€æ”¾åœ¨é¡¶éƒ¨å³ä¸Šè§’ï¼Œä½¿ç”¨ `shrink-0` é˜²æ­¢å‹ç¼©

### å¸ƒå±€è¦ç‚¹

**å¯¹è¯æ¡†ç»“æ„**ï¼š
```
DialogContent (flex flex-col p-0)
â”œâ”€â”€ å›ºå®šé¡¶éƒ¨åŒºåŸŸ (sticky top-0 z-10)
â”‚   â”œâ”€â”€ æ ‡é¢˜å’Œæè¿° (flex-1)
â”‚   â””â”€â”€ æ“ä½œæŒ‰é’®ç»„ (shrink-0)
â””â”€â”€ å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ (flex-1 overflow-y-auto)
    â””â”€â”€ è¡¨å•å†…å®¹
```

**å…³é”® CSS ç±»**ï¼š
- `DialogContent`: `flex flex-col p-0` - å»ºç«‹ flex å®¹å™¨ï¼Œç§»é™¤é»˜è®¤ padding
- é¡¶éƒ¨åŒºåŸŸ: `sticky top-0 z-10 bg-background border-b px-6 py-4` - å›ºå®šå®šä½
- æŒ‰é’®å®¹å™¨: `flex gap-2 shrink-0` - é˜²æ­¢æŒ‰é’®è¢«å‹ç¼©
- å†…å®¹åŒºåŸŸ: `flex-1 overflow-y-auto px-6 py-4` - å¯æ»šåŠ¨åŒºåŸŸ
